---
title: ä½¿ç”¨Gradioæ„å»ºäº¤äº’å¼Webåº”ç”¨-P3
subtitle: Gradioä¸é¥æ„Ÿæ•°æ®å¤„ç†ï¼ˆä¸Šï¼‰
author: 
  - "äºå³»å·"
date: "2024-8-1"
categories:
  - Posts
  - Gradio
  - APP
  - Deep learning
image: https://dunazo.oss-cn-beijing.aliyuncs.com/blog/Gradio.png
toc: true
---


# ä½¿ç”¨Gradioæ„å»ºäº¤äº’å¼Webåº”ç”¨

<br><br>
è¿™æ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•ä½¿ç”¨ Gradio æ„å»º Web åº”ç”¨ç¨‹åºçš„å¼€æºç³»åˆ—æ•™ç¨‹ã€‚ä½ å°†ä»è®¾ç½® Python ç¯å¢ƒå¼€å§‹ï¼Œå­¦ä¹ æ–‡æœ¬ã€å›¾åƒç­‰å„ç±»è¾“å…¥ç»„ä»¶ï¼Œè‡ªå®šä¹‰ç•Œé¢ï¼Œè®¾è®¡å¤æ‚çš„äº¤äº’ç­‰ã€‚æœ¬è¯¾ç¨‹è¿˜å°†æ¶µç›–ä½¿ç”¨ Gradio å’Œ GDAL å¤„ç†é¥æ„Ÿæ•°æ®ï¼Œç”¨äºå›¾åƒå¢å¼ºã€åœ°ç†åæ ‡è½¬æ¢ã€å¡åº¦åˆ†æç­‰ä»»åŠ¡ï¼›å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Gradio å’Œ Foliumap åˆ›å»ºäº¤äº’å¼åœ°å›¾ï¼Œå®ç°åŠ¨æ€åœ°ç†ç©ºé—´æ•°æ®å¯è§†åŒ–ï¼›å¦‚ä½•é›†æˆæœºå™¨å­¦ä¹ æ¨¡å‹å¹¶åœ¨ Hugging Face Spaces ä¸Šå‘å¸ƒ web åº”ç”¨ç¨‹åºã€‚æœ¬æ•™ç¨‹åŒ…æ‹¬å®ä¾‹ã€æ¼”ç¤ºå’Œä½œä¸šã€‚å®Œæˆæœ¬æ•™ç¨‹åï¼Œä½ å°†èƒ½å¤Ÿé«˜æ•ˆåœ°æ„å»ºã€éƒ¨ç½²å’Œå…±äº«äº¤äº’å¼ Web åº”ç”¨ç¨‹åºã€‚
è¯¾ç¨‹ç›¸å…³é…å¥—è¯·åœ¨æ–‡æœ«è·å–ã€‚
<br><br>
è¯¾ç¨‹ç›¸å…³èµ„æºé“¾æ¥[GITHUB](https://github.com/JunchuanYu/Building_Interactive_Web_APP_with_Gradio)

![](https://dunazo.oss-cn-beijing.aliyuncs.com/blog/Gradio_07_1.png)

<br><br>
## Part3 ï¼šGradioä¸é¥æ„Ÿæ•°æ®å¤„ç†ï¼ˆä¸Šï¼‰

<br><br>

### DEMO 3-1: å¤šé€šé“é¥æ„Ÿæ•°æ®çš„å¯è§†åŒ–

<br><br>

åœ¨åˆ©ç”¨Gradioè¿›è¡Œé¥æ„Ÿæ•°æ®å¤„ç†æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨é¥æ„Ÿæ•°æ®çš„è¯»å–ï¼Œå¯è§†åŒ–ä»¥åŠæ¸²æŸ“æ–¹å¼ã€‚æœ¬æ¡ˆä¾‹ä¸­ä»¥â€œclassification.tifâ€ä¸ºä¾‹ï¼Œè¯¥å½±åƒå‰ä¸‰ä¸ªæ³¢æ®µä¸ºRGBä¿¡æ¯ï¼Œç¬¬å››ä¸ªé€šé“ä¸ºåˆ†ç±»ç»“æœä¿¡æ¯ã€‚

- **è¯»å–** gr.Imageæ˜¯æˆ‘ä»¬å‘ˆç°é¥æ„Ÿå›¾åƒçš„å”¯ä¸€æ¥å£ï¼Œå®ƒé»˜è®¤æ¥å—ä¸‰ç§å½¢å¼æ•°æ®ï¼ŒPILå¯¹è±¡ï¼Œå­—ç¬¦ä¸²å½¢å¼çš„å›¾åƒè·¯å¾„ä»¥åŠnumpyæ•°ç»„ï¼Œå‰ä¸¤è€…å‡åªæ”¯æŒpngï¼Œjpgç­‰æ ¼å¼çš„è‡ªç„¶å›¾åƒï¼Œtiffï¼Œimgï¼Œdatï¼Œhdf5ç­‰å¤šé€šé“çš„é¥æ„Ÿå½±åƒå‡ä¸æ”¯æŒï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªé¥æ„Ÿå½±åƒè¯»å–çš„å‡½æ•°å°†é¥æ„Ÿå½±åƒè½¬æ¢ä¸ºnumpyæ•°ç»„ã€‚

- **å¯è§†åŒ–** ç”¨äºå¯è§†åŒ–çš„numpyæ•°ç»„éœ€è¦ç¬¦åˆmatplotlib.pyplotçš„æ¸²æŸ“è¦æ±‚ï¼Œå³0-255æ•´å½¢æ•°ç»„æˆ–0-1çš„æµ®ç‚¹å‹æ•°ç»„ã€‚æ­¤å¤–ï¼Œå½“å‘ˆç°å•é€šé“å½±åƒå¦‚åˆ†ç±»ç»“æœçš„æ—¶å€™ï¼Œè¿˜éœ€è¦è®¾ç½®è‰²å¸¦ã€‚

- **è¾“å…¥** ç”±äºæ— æ³•ç›´æ¥ç”¨gr.Imageæ¥æ”¶é¥æ„Ÿå½±åƒï¼Œå› æ­¤è¾“å…¥é€šå¸¸æ˜¯æ–‡ä»¶è·¯å¾„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Šä¼ æˆ–ç»™å‡ºç»å¯¹è·¯å¾„å­—ç¬¦ä¸²æ¥å®ç°è¾“å…¥,éœ€è¦æ³¨æ„çš„æ˜¯ä¸Šä¼ æ˜¯å°†æœ¬åœ°æ–‡ä»¶è¿›è¡Œæ‹·è´ï¼Œä½œä¸ºä¸´æ—¶æ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚

- **é¥æ„Ÿå‚æ•°** æŠ•å½±ä¿¡æ¯ç­‰å¯ä»¥é€šè¿‡æ–‡æœ¬å½¢å¼è¿›è¡Œä¼ é€’ï¼Œéœ€è¦æ³¨æ„æ•°æ®æ ¼å¼çš„å¯¹é½ï¼Œæ¯”å¦‚functionä¸­è¾“å‡ºä¸ºstrï¼Œæ¥æ”¶çš„gradioç»„ä»¶ä¹Ÿåº”æ”¯æŒstrï¼Œæœ¬æ¡ˆä¾‹ä¸­æ˜¯å°†é¥æ„Ÿå‚æ•°ä¿¡æ¯ä½œä¸ºå­—ç¬¦ä¸²è¿›è¡Œå±•ç¤ºã€‚

- **logging** ä¸ºäº†ç›‘æ§ç¨‹åºçš„å¤„ç†è¿‡ç¨‹ï¼Œæˆ‘ä»¬ç”¨loggingå¯¹å¤„ç†è¿‡ç¨‹è¿›è¡Œåå°æ’­æŠ¥ä»¥åŠè®°å½•ã€‚

<br><br>

```python
from osgeo import gdal, osr
import gradio as gr
import numpy as np
import matplotlib.pyplot as plt
import logging

# ä½¿ç”¨æ—¥å¿—è®°å½•åº”ç”¨çš„çŠ¶æ€
logging.basicConfig(filename='app.log', level=logging.INFO, format='%(asctime)s:%(levelname)s:%(message)s')

# å®šä¹‰å›¾åƒçš„çº¿æ€§æ‹‰ä¼¸å‡½æ•°ï¼Œç”¨äºå¢å¼ºå¯¹æ¯”åº¦
def stretch_n(band, lower_percent=5, higher_percent=95): 
    band=np.array(band,dtype=np.float32)
    c = np.percentile(band, lower_percent)*1.0
    d = np.percentile(band, higher_percent)*1.0       
    band[band<c] = c
    band[band>d] = d
    out =  (band - c)  / (d - c)  
    return out.astype(np.float32)

# å¯¹æ¯ä¸ªæ³¢æ®µè¿›è¡Œå¯¹æ¯”åº¦è°ƒæ•´
def adjust_contrast(data,n_band=3):    
    data=np.array(data,dtype=np.float32)
    for img in data:
        for k in range(n_band):
            img[:,:,k] = stretch_n(img[:,:,k])
    return data

def Load_image_by_Gdal(file_path):
    img_file = gdal.Open(file_path, gdal.GA_ReadOnly)
    img_bands = img_file.RasterCount # æ³¢æ®µæ•°é‡
    img_height = img_file.RasterYSize # é«˜åº¦
    img_width = img_file.RasterXSize # å®½åº¦
    img_arr = img_file.ReadAsArray() # è·å–å›¾åƒæ•°ç»„
    geomatrix = img_file.GetGeoTransform() # è·å–åœ°ç†å˜æ¢çŸ©é˜µ
    projection = img_file.GetProjectionRef() # è·å–æŠ•å½±ä¿¡æ¯
    return img_bands,img_arr, geomatrix, projection

# å®šä¹‰è¯»å–tiffæ–‡ä»¶çš„å‡½æ•°
def read_tiff(file):
    img_bands,img_arr, geomatrix, projection =Load_image_by_Gdal(file)
    if img_bands >1 :
        img_arr=img_arr.transpose(( 1, 2,0))
    return img_arr, geomatrix, projection

# å®šä¹‰é‡ç½®çŠ¶æ€çš„å‡½æ•°
def reset_state():
    return None,None,None,[]

# å®šä¹‰æ–‡ä»¶ä¸Šä¼ åçš„å›¾åƒå¤„ç†å’Œå¯è§†åŒ–å‡½æ•°
def upload_file(files):
    print(files,files.name) # å¦‚æœä½ ä¸ç¡®å®šgradioç»„ä»¶çš„è¾“å‡ºæ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œå¯ä»¥é€šè¿‡æ‰“å°æ¥è¿›è¡Œç¡®è®¤ï¼Œæ­¤å¤„filesä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œèµ·ç»å¯¹è·¯å¾„ä¸ºfiles.nameã€‚
    logging.info(f"File uploaded: {files.name}")
    file_patchs=files.name
    img_arr, geomatrix, projection=read_tiff(file_patchs)
    rgb=img_arr.copy()[:,:,:3]
    mask=img_arr.copy()[:,:,-1]
    img=adjust_contrast(np.expand_dims(rgb,axis=0))
    palette = np.array([ [83,49,125],   [56,173,20],   [210,10,115], [19,188,106], [16,96,160]]) # è‡ªå®šä¹‰è‰²å¸¦
    predc=palette[mask]
    
    dict_info={"image shape":img_arr.shape,"max value":np.max(img_arr)}
    if isinstance(projection, str):
        spatial_ref = osr.SpatialReference()
        spatial_ref.ImportFromWkt(projection)
        utm_zone = spatial_ref.GetUTMZone()
        if utm_zone:
            dict_info["UTM zone"] = utm_zone
            dict_info["Projection"] = f"WGS 84 / UTM Zone {utm_zone}"
    
    # å°†å­—å…¸ä¿¡æ¯è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªé”®å€¼å¯¹å ä¸€è¡Œ
    info_lines = "\n".join([f"{key}: {value}" for key, value in dict_info.items()])
    
    logging.info(f"File info: {info_lines}")
    return img[0],predc,info_lines # è¿”å›å½’ä¸€åŒ–åçš„RGBæ•°ç»„ï¼Œæ©è†œå›¾åƒæ•°ç»„å’Œå½±åƒä¿¡æ¯

# ä½¿ç”¨gradioçš„Blocksåˆ›å»ºç”¨æˆ·ç•Œé¢
with gr.Blocks(theme="gradio/sketch") as demo: # ä½¿ç”¨è‰å›¾ä¸»é¢˜

    gr.Markdown('''# <center>Remote Sensing Imagery Visulization</center>''')  # æ ‡é¢˜ï¼Œä½¿ç”¨markdownè¯­æ³•
    upload_button = gr.UploadButton("Click to Upload a Tiff", file_types=["tiff"], file_count="single") # å®šä¹‰ä¸Šä¼ æŒ‰é’®
    with gr.Row():
        showimg=gr.Image(label="RGB") # è¾“å‡ºRGBå›¾åƒæ•°ç»„
        img_output = gr.Image(label="label") # è¾“å‡ºæ©è†œå›¾åƒæ•°ç»„
    outtext=gr.Textbox(label="img_info") # è¾“å‡ºå›¾åƒä¿¡æ¯
    emptyBtn = gr.Button("Restart",variant="secondary") 

    # ä¸ºä¸Šä¼ æŒ‰é’®è®¾ç½®ä¸Šä¼ æ–‡ä»¶åçš„å¤„ç†å‡½æ•°
    upload_button.upload(upload_file, upload_button, [showimg,img_output,outtext]) 

    # ä¸ºé‡å¯æŒ‰é’®è®¾ç½®ç‚¹å‡»åçš„åŠ¨ä½œ
    emptyBtn.click(reset_state,outputs=[upload_button,showimg,img_output,outtext],show_progress=True)  
        
demo.launch()
```

![](https://dunazo.oss-cn-beijing.aliyuncs.com/blog/demo3-1.gif)




### DEMO 3-2: DEMå¯è§†åŒ–ä¸å¡åº¦è®¡ç®—

<br><br>

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å¯è§†åŒ–éœ€æ±‚ä¸é¥æ„Ÿæ•°æ®è®¡ç®—éœ€æ±‚çš„å·®å¼‚ï¼ŒåŒæ—¶ä¸ºäº†å®ç°æ›´ä¸ºæµç•…çš„åº”ç”¨ä½“éªŒï¼Œéœ€è¦æŒæ¡ç®€åŒ–äº¤äº’çš„ä¸€äº›æ“ä½œæŠ€å·§ã€‚æœ¬æ¡ˆä¾‹ä¸­ä»¥â€œDEM.tifâ€åœ°å½¢æ•°æ®ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚

- **æ•°å€¼è®¡ç®—** ç”±äºgr.Imageåªèƒ½ç”¨äºæ˜¾ç¤ºå•é€šé“ç°åº¦æˆ–çœŸå½©è‰²å›¾åƒï¼Œå› æ­¤åœ¨éœ€è¦è¿›è¡Œé¥æ„Ÿæ•°å€¼è®¡ç®—çš„æƒ…å†µä¸‹ï¼Œé€šå¸¸éœ€è¦å‡†å¤‡ä¸¤ä¸ªnumpyæ•°ç»„å¯¹å¯¹è±¡è¿›è¡Œä¿å­˜ï¼Œä¸€ä¸ªè¿›è¡Œå½’ä¸€åŒ–ç”¨äºæ˜¾ç¤ºï¼Œä¸€ä¸ªè®°å½•åŸå§‹numpyæ•°æ®ç”¨äºåç»­åˆ†æè®¡ç®—ã€‚

- **ä¸´æ—¶å˜é‡** å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªå¯¹è±¡æ— æ³•ç”¨ç°æœ‰çš„Gradioæ¨¡å—æ¥å®šä¹‰æˆ–æ¥æ”¶ï¼Œä¾‹å¦‚å¤šç»´æ•°ç»„ï¼Œæˆ‘ä»¬éœ€è¦ç”¨gr.Stateæ¥å•ç‹¬å®šä¹‰ä¸´æ—¶å˜é‡æ¥æ‰¿æ¥è¿™ä¸ªå¯¹è±¡ï¼Œæœ¬æ¡ˆä¾‹ä¸­å®šä¹‰äº†ä¸€ä¸ªåˆå§‹å€¼ä¸ºNONEçš„å˜é‡demarrayæ¥æ‰¿æ¥show_demå‡½æ•°è¾“å‡ºçš„demæ•°ç»„ã€‚

- **ä½¿ç”¨æŒ‰é’®ï¼Ÿ** æŒ‰é’®æ˜¯Gradioåº”ç”¨ä¸­å¿…ä¸å¯å°‘çš„ç»„ä»¶ï¼Œæˆ‘ä»¬åœ¨ä¸€äº›å…³é”®äº¤äº’åœºæ™¯ä¸­éƒ½éœ€è¦ä½¿ç”¨æŒ‰é’®ï¼Œæ¯”å¦‚é€‰æ‹©æ•°æ®ï¼Œè¿è¡Œç¨‹åºï¼Œé‡ç½®å˜é‡ç­‰ç­‰ã€‚ä½†æŒ‰é’®è®¾ç½®è¿‡å¤šï¼Œä¸”æ²¡æœ‰åˆç†çš„å¼•å¯¼ä¼šå¯¼è‡´äº¤äº’ä½“éªŒå˜å·®ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡Gradioç»„ä»¶å¸¦æœ‰çš„äº‹ä»¶æ¿€æ´»å™¨æ¥å®ç°åŠ¨æ€äº¤äº’ã€‚æœ¬ä¾‹ä¸­æˆ‘ä»¬æä¾›äº†ä¸¤å¥—å…·æœ‰ç›¸åŒåŠŸèƒ½çš„ä»£ç ï¼Œä¸€å¥—æ˜¯é‡‡ç”¨æŒ‰é’®ï¼Œä¸€å¥—æ˜¯ä½¿ç”¨äº‹ä»¶æ¿€æ´»å™¨ã€‚

- **è¯´æ˜æ–‡æœ¬** æˆ‘ä»¬å¯ä»¥é€šè¿‡æ–‡æœ¬æ¥è®¾ç½®åº”ç”¨ç¨‹åºçš„æ ‡é¢˜ï¼Œå¯¹å…³é”®å˜é‡åšè§£é‡Šï¼Œè®¾ç½®æ˜¯åœ¨åº”ç”¨ä¸‹æ–¹ç»™å‡ºå®Œæ•´çš„æŠ€æœ¯æŠ¥å‘Šã€‚ç›¸å¯¹äºgr.Markdownä½¿ç”¨gr.HTMLå¯ä»¥å®ç°æ›´ä¸ºä¸°å¯Œå¤šå…ƒçš„æ–‡æœ¬å†…å®¹ã€‚

<br><br>

```python
from osgeo import gdal, osr
import gradio as gr
import numpy as np
import matplotlib.pyplot as plt

# Load_image_by_Gdalï¼Œread_tiff å‡½æ•°åŒå‰ï¼Œæ­¤å¤„çœç•¥
# è®¡ç®—å¹¶å¯è§†åŒ–DEMçš„å¡åº¦
def showslope(dem_array, colormap='terrain'):
    x_gradient = np.gradient(dem_array, axis=1)
    y_gradient = np.gradient(dem_array, axis=0)
    slope = np.sqrt(x_gradient**2 + y_gradient**2)
    print(dem_array.shape, np.max(slope), np.min(slope))
    slope = np.clip(slope, 0, 90) / 90
    cmap = plt.get_cmap(colormap)
    colormapped_slope = cmap(slope)
    slope_array = colormapped_slope[:, :, :3]
    return dem_array/np.max(dem_array),slope_array

# å®šä¹‰é‡ç½®çŠ¶æ€çš„å‡½æ•°
def reset_state():
    return None, None, None

# å®šä¹‰DEMå¯è§†åŒ–å‡½æ•°
def show_dem(files):
    file_patchs = files.name
    img_arr, _, _ = read_tiff(file_patchs)
    dem_array = img_arr.copy()
    return dem_array

with gr.Blocks(theme="Gstaff/Xkcd") as demo:  # æœ¬æ¡ˆä¾‹é‡‡ç”¨é»‘ç™½é£æ ¼ä¸»é¢˜ï¼Œå…¶ä»–ä¸»é¢˜ï¼š["Default", "Glass", "Monochrome", "Gstaff/Xkcd", "NoCrypt/Miku", "gradio/soft"]
    demarray = gr.State(None)  # å®šä¹‰ä¸´æ—¶å˜é‡
    # æ·»åŠ HTMLå¤´éƒ¨
    gr.HTML("""
                <center> 
                <h1> DEM and Slope Visulization  ğŸ›°ï¸ </h1>
                <b> jason.yu.mail@qq.com  ğŸ“§<b>
                </center>
                """) 
    upload_button = gr.UploadButton("Click to Upload a DEM File", file_types=["image"], file_count="single")
    with gr.Row():
        with gr.Column(scale=50):
            choice = gr.Radio(choices=["rainbow", "plasma", "terrain"], label="Colormap")
        with gr.Column(scale=50):
            showdem = gr.Button("Showdem", variant="primary")
            emptyBtn = gr.Button("Restart", variant="secondary")  # ä¸ºæŒ‰é’®è®¾ç½®ä¸åŒçº§åˆ«çš„ä¸»é¢˜ï¼Œvariant="primary" ä¸ºä¸»è‰²è°ƒï¼Œsecondaryä¸ºå‰¯è‰²è°ƒ
    with gr.Row():
        showimg = gr.Image(label="DEM")
        img_output = gr.Image(label="å¡åº¦")

    # ä½¿ç”¨ä¸´æ—¶å˜é‡demarrayæ¥æ”¶show_demå‡½æ•°è¾“å‡ºçš„demæ•°ç»„
    upload_button.upload(show_dem, upload_button, [demarray])
    # å®šä¹‰æŒ‰é’®ç‚¹å‡»äº‹ä»¶ä»¥åŒæ—¶æ˜¾ç¤ºdemå½±åƒåŠå¡åº¦å›¾åƒ
    showdem.click(showslope, [demarray, choice], [showimg,img_output])

    emptyBtn.click(reset_state, outputs=[upload_button, showimg, img_output], show_progress=True)

demo.launch()
```

<br><br>

ä¸Šé¢ä¾‹å­çš„ç¼ºç‚¹æ˜¯éœ€è¦é€‰æ‹©æ¸²æŸ“é£æ ¼å†ç‚¹å‡»æŒ‰é’®æ‰èƒ½å¤Ÿå±•ç¤ºå›¾åƒï¼Œå¯¹äºç›®çš„æ˜ç¡®çš„åº”ç”¨å¯ä»¥è®¾è®¡çš„æ›´ä¸ºç®€æ´ï¼Œå‡å°‘äº¤äº’æ¬¡æ•°ã€‚å› æ­¤å¯ä»¥åšä¸¤ä¸ªæ–¹é¢çš„ä¿®æ”¹ï¼Œä¸€æ˜¯ï¼Œæ•°æ®ä¸Šä¼ ä¹‹åå³æ˜¾ç¤ºï¼Œå–æ¶ˆç‚¹å‡»åå†æ˜¾ç¤ºï¼›äºŒæ˜¯ï¼Œå®ç°åœ¨é€‰æ‹©æ¸²æŸ“é£æ ¼çš„åŒæ—¶å³å®æ—¶æ˜¾ç¤ºæ•ˆæœã€‚ä»£ç ä¿®æ”¹çš„å†…å®¹å¦‚ä¸‹ï¼š

<br><br>

```python

# Load_image_by_Gdalï¼Œread_tiffï¼Œreset_state å‡½æ•°åŒå‰ï¼Œæ­¤å¤„çœç•¥
# è®¡ç®—å¹¶å¯è§†åŒ–DEMçš„å¡åº¦
def calculate_slope(files, colormap='terrain'):
    print(files.name, colormap)
    file_patchs = files.name
    img_arr, _, _ = read_tiff(file_patchs)
    dem_array = img_arr.copy()
    print(dem_array.shape, np.max(dem_array))
    # è®¡ç®—xå’Œyæ–¹å‘çš„æ¢¯åº¦
    x_gradient = np.gradient(dem_array, axis=1)
    y_gradient = np.gradient(dem_array, axis=0)
    # è®¡ç®—å¡åº¦
    slope = np.sqrt(x_gradient**2 + y_gradient**2)
    print(dem_array.shape, np.max(slope), np.min(slope))
    slope = np.clip(slope, 0, 90) / 90
    cmap = plt.get_cmap(colormap)
    colormapped_slope = cmap(slope)
    slope_array = colormapped_slope[:, :, :3]  # æå–RGBæ³¢æ®µ
    return dem_array / np.max(dem_array), slope_array #è¿”å›ä¸€ä¸ªå½’ä¸€åŒ–çš„demæ•°ç»„ï¼Œä¸€ä¸ªslopeæ•°ç»„

with gr.Blocks(theme="Gstaff/Xkcd") as demo:  
    demarray = gr.State(None)  
    gr.HTML("""
                <center> 
                <h1> DEM and Slope Visulization  ğŸ›°ï¸ </h1>
                <b> jason.yu.mail@qq.com  ğŸ“§<b>
                </center>
                """) 
    upload_button = gr.UploadButton("Click to Upload a DEM File", file_types=["image"], file_count="single")
    with gr.Row():
        with gr.Column(scale=50):
            choice = gr.Radio(choices=["rainbow", "plasma", "terrain"], label="Colormap")
        with gr.Column(scale=50):
            showdem = gr.Button("Showdem", variant="primary")
            emptyBtn = gr.Button("Restart", variant="secondary")  
    with gr.Row():
        showimg = gr.Image(label="DEM")
        img_output = gr.Image(label="å¡åº¦")

    # å¯¹æŒ‰é’®è®¾ç½®äº‹ä»¶ç›‘å¬å™¨ï¼Œå½“æœ‰æ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™ï¼Œä¾¿æ¿€æ´»calculate_slopeå‡½æ•°æ¥æ˜¾ç¤ºdemæ•°æ®
    upload_button.upload(calculate_slope, [upload_button], [showimg,img_output]) 
    # è®¾ç½®ç±»ä¼¼çš„äº‹ä»¶è§¦å‘å™¨åœ¨choiceæŒ‰é’®ä¸Šï¼Œéœ€è¦æ³¨æ„çš„æ˜¯calculate_slopeå‡½æ•°å¯ä»¥æ¥æ”¶ä¸¤ä¸ªè¾“å…¥å€¼ï¼Œå…¶ä¸­colormapæ˜¯å…·å¤‡é»˜è®¤å€¼çš„ï¼Œæ­¤å¤„ç”±choiceé€‰é¡¹çš„æ•°å€¼å¯¹å…¶è¿›è¡Œæ›´æ–°
    choice.change(calculate_slope, [upload_button,choice], [showimg,img_output])

    emptyBtn.click(reset_state, outputs=[upload_button, showimg, img_output], show_progress=True)

demo.launch()
```


![](https://dunazo.oss-cn-beijing.aliyuncs.com/blog/demo3-2_new.gif)

---------------------------
è¯·å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ã€45åº¦ç§‘ç ”äººã€‘å›å¤â€œ**@gradio**â€è·å–è¯¥æ•™ç¨‹é…å¥—æ•°æ®ï¼Œæ¬¢è¿åå°ç•™è¨€ï¼


<span style="display: block; text-align: center; margin-left: auto; margin-right: auto;">
    <img src="https://dunazo.oss-cn-beijing.aliyuncs.com/blog/wechat-simple.png" width="200"  alt="">
</span>

---------------------------

ä¸ºäº†ä¿ƒè¿›æ²Ÿé€šä¸äº¤æµï¼Œæˆ‘ä»¬å»ºç«‹äº†ã€Œå…»ç”Ÿç§‘ç ”ã€å­¦æœ¯äº¤æµç¾¤ã€‚è¿™ä¸ªå¹³å°ä¸ä»…èƒ½å¤Ÿè®©å¤§å®¶è¿…é€Ÿè·å–æœ¬å…¬ä¼—å·çš„èµ„æºï¼Œè¿˜ä¸ºå„ä½æä¾›äº†ä¸€ä¸ªå…±åŒæ¢è®¨é—®é¢˜ã€äº¤æµæ€æƒ³çš„ç©ºé—´ã€‚æœ‰æ„å‘åŠ å…¥äº¤æµç¾¤çš„æœ‹å‹ä»¬ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ å°ç¼–çš„å¾®ä¿¡æ¥è·å¾—å…¥ç¾¤é‚€è¯·ã€‚è¯·æ³¨æ„ï¼Œåœ¨æ·»åŠ æ—¶è¯·æŒ‰ç…§â€œåŠ ç¾¤-å•ä½-ç ”ç©¶æ–¹å‘-å§“åâ€çš„æ ¼å¼å¤‡æ³¨æ‚¨çš„ä¿¡æ¯ï¼Œå¦åˆ™æ‚¨çš„ç”³è¯·å¯èƒ½æ— æ³•é€šè¿‡ã€‚


<span style="display: block; text-align: center; margin-left: auto; margin-right: auto;">
    <img src="https://dunazo.oss-cn-beijing.aliyuncs.com/blog/laidian.jpg" width="200"  alt="">
</span>
